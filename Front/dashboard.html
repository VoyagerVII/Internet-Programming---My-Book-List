<!DOCTYPE html>
<html lang="en">


<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>My Book List - Dashboard</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 0;
            background-color: #ffedba;
        }

        header {
            background-color: #C7AE6E;
            color: white;
            padding: 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        header h1 {
            margin: 0;
            color: #000;
            font-size: x-large;
        }

        .heading h4 {
            color: white;
            margin: 0;
        }

        .nav-links {
            list-style-type: none;
            padding: 0;
            margin: 0;
            display: flex;
            gap: 15px;
        }

        .nav-links a {
            color: white;
            text-decoration: none;
            padding: 5px 10px;
            border-radius: 4px;
        }

        .nav-links a:hover,
        .nav-links .active {
            background-color: #4caf50;
        }

        .menu-options {
            list-style-type: none;
            padding: 0;
            margin: 10px 0;
            display: flex;
            gap: 20px;
            background-color: rgb(59, 124, 70);
            padding: 10px;
        }

        .menu-options a {
            color: whitesmoke;
            text-decoration: none;
            padding: 5px 10px;
            border-radius: 4px;
        }

        .menu-options a:hover {
            background-color: #4caf50;
        }

        #results {
    display: grid;
    grid-template-columns: repeat(5, 1fr); /* Creates 5 columns */
    gap: 20px; /* Space between grid items */
    padding: 20px;
}

.book-item {
    background-color: #fff;
    padding: 10px;
    border-radius: 8px;
    box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
    text-align: center;
}
    </style>
</head>

<body>
    <header>
        <h1>Welcome back, $username.</h1>
        <nav>
            <div class="heading">
                <h4>MyBookList</h4>
            </div>

            <ul class="nav-links">
                <li><a href="index.html">Home</a></li>
                <li><a href="./contact.html">Contact</a></li>
                <li><a class="active" href="./login.html">Logout</a></li>
            </ul>
        </nav>
    </header>
    <ul class="menu-options">
        <li><a href="#">Reading Now</a></li>
        <li><a href="#">Bookshelves</a></li>
        <li><a href="#">Add Bookshelf</a></li>
        <li><a href="#">Search</a></li>
    </ul>

    <div id="search-section">
        <input type="text" id="bookSearch" placeholder="Search for a book...">
        <button onclick="searchBook()">Search</button>
    </div>
    <div id="results"></div>
    
    <script type="text/javascript" src="src/ServerComs.js"></script>
    
    
    <script>
    
    let userBookshelf = []; // Global variable to store bookshelf data
    let searchResults = []; // Global variable to store search results

    
    let userID;
    let booklistID;
    // INITIALIZE TEST
    async function initializeApp() {

    try {
        userID = await CreateNewUser('Test4', "testpass");
        booklistID = await CreateNewBookList(userID, 'Test BookList');
        // Additional initialization or function calls that depend on these IDs
    } catch (error) {
        console.error("Error initializing app:", error);
        // Handle initialization errors
    }
}

// Call this function when appropriate (e.g., when the page loads)
initializeApp();


function searchBook() {
    const query = document.getElementById('bookSearch').value;
    const API_KEY = 'AIzaSyBASUxdn6U-raB77D5B5cp4KH5y90VIAMU'; // Replace with your Google Books API Key
    const endpoint = `https://www.googleapis.com/books/v1/volumes?q=${query}&key=${API_KEY}`;

    fetch(endpoint)
        .then(response => response.json())
        .then(data => {
            searchResults = data.items; // Store the search results in the global variable
            displayResults(data);
        })
        .catch(err => {
            console.error('Error fetching data:', err);
        });
}

function displayResults(data) {
    const resultsDiv = document.getElementById('results');
    resultsDiv.innerHTML = ''; // Clear previous results

    data.items.forEach((item, index) => {
        const bookTitle = item.volumeInfo.title;
        const bookAuthors = item.volumeInfo.authors ? item.volumeInfo.authors.join(', ') : 'Unknown Author';
        
        // Get book cover image
        const bookCover = item.volumeInfo.imageLinks ? item.volumeInfo.imageLinks.thumbnail : 'path_to_default_image.jpg';

        // Get ISBN
        let isbn10 = "N/A";
        if (item.volumeInfo.industryIdentifiers) {
            for (let identifier of item.volumeInfo.industryIdentifiers) {
                if (identifier.type === 'ISBN_10') {
                    isbn10 = identifier.identifier;
                    break;
                }
            }
        }

        // Get preview link
        const previewLink = item.volumeInfo.previewLink;

        resultsDiv.innerHTML += `<div class="book-item">
                                    <img src="${bookCover}" alt="${bookTitle} cover" width="100">
                                    <h3>${bookTitle}</h3>
                                    <p>${bookAuthors}</p>
                                    <p>ISBN-10: ${isbn10}</p>
                                    <a href="${previewLink}" target="_blank">Preview Book</a>
                                    <button onclick="addToBookshelf(${index})">Add to Bookshelf</button>
                                 </div>`;
    });
}

async function addToBookshelf(index) {
    const bookToAdd = searchResults[index]; // Use the global searchResults array
    const bookTitle = bookToAdd.volumeInfo.title;
    let isbn = "N/A";
    if (bookToAdd.volumeInfo.industryIdentifiers) {
        for (let identifier of bookToAdd.volumeInfo.industryIdentifiers) {
            if (identifier.type === 'ISBN_10' || identifier.type === 'ISBN_13') {
                isbn = identifier.identifier;
                break;
            }
        }
    }

    // Use the AddBook function from ServerComs.js
    try {
        await AddBook(userID, booklistID, isbn);
        userBookshelf.push(bookToAdd); // Add the selected book to the bookshelf
    } catch (err) {
        console.error('Error adding book to bookshelf:', err);
    }
}


function updateBookshelfDisplay() {
    const bookshelfDiv = document.getElementById('bookshelf');
    bookshelfDiv.innerHTML = ''; // Clear previous bookshelf display

    userBookshelf.forEach((book, index) => {
        const bookTitle = book.volumeInfo.title;
        const bookCover = book.volumeInfo.imageLinks ? book.volumeInfo.imageLinks.thumbnail : 'path_to_default_image.jpg';

        bookshelfDiv.innerHTML += `<div class="book-item">
                                       <img src="${bookCover}" alt="${bookTitle} cover" width="100">
                                       <h3>${bookTitle}</h3>
                                   </div>`;
    })};


    </script>
    


</body>

</html>
